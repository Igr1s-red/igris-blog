---
layout: post
title: "Understanding KASan: Fortifying Kernel Security with Advanced AddressSanitization"
date: 2024-07-20 11:19:20 +0700
categories: kernel linux
---

_Kernel Address Sanitizer (KASAN)_ is a fast memory corruption detector for the Linux kernel. KASAN detects out-of-bounds, use-after-free, and invalid-free bugs in slab, page_alloc, vmalloc, stack, and global memory.

KASAN has 3 modes:

- [Generic KASAN](https://www.kernel.org/doc/html/latest/dev-tools/kasan.html#generic-kasan), which is intended to be used for debugging. This mode is supported by many CPU architectures.
- [Software Tag-Based KASAN](https://www.kernel.org/doc/html/latest/dev-tools/kasan.html#software-tag-based-kasan), which is intended for testing in near-production environments. This mode has a lower RAM overhead than the Generic mode but is only supported on arm64.
- [Hardware Tag-Based KASAN](https://www.kernel.org/doc/html/latest/dev-tools/kasan.html#hardware-tag-based-kasan), which intended to be used in production as an in-field bug detector or a security mitigation. This mode is based on the Arm Memory Tagging Extension and is expected to have a very low performance overhead.

For more details about each mode, see the [kernel documentation](https://www.kernel.org/doc/html/latest/dev-tools/kasan.html) and these talks:

- [Sanitizing the Linux kernel](https://docs.google.com/presentation/d/1qA8fqRDHKX_WM_ZdDN37EQQZwSTNJ4FFws82tbUSKxY/edit?usp=sharing) at Linux Security Summit Europe 2022
- [Memory Tagging for the kernel: Tag-Based KASAN](https://docs.google.com/presentation/d/10V_msbtEap9dNerKvTrRAzvfzYdrQFC8e2NYHCZYJDE/edit?usp=sharing) [[video](https://www.youtube.com/watch?v=9wRT2hNwbkA)] at Android Security Symposium 2020
- [Mitigating Linux kernel memory corruptions with Arm Memory Tagging](https://docs.google.com/presentation/d/1IpICtHR1T3oHka858cx1dSNRu2XcT79-RCRPgzCuiRk/edit?usp=sharing) [[video](https://www.youtube.com/watch?v=UwMt0e_dC_Q)] at Linux Security Summit 2021

See [KFENCE](https://google.github.io/kernel-sanitizers/KFENCE.html) for an alternative sampling-based low-overhead memory corruption detector that can be used in production environments.

---

**Configuration:**

```bash
CONFIG_KASAN=y
CONFIG_KASAN_GENERIC=y
```

Optionally, you can pass KASAN specific parameters at boot time to control its behavior:

```bash
kasane=1                 # Enable KASAN
kasan-out-of-bounds=on   # Report out-of-bounds access
kasan-use-after-free=on  # Report use-after-free bugs
```

Check kernel logs (`dmesg` command) or system logs (`/var/log/messages`, `/var/log/syslog`) for KASAN reports.

---

**References :**

- [https://google.github.io/kernel-sanitizers](https://google.github.io/kernel-sanitizers)
- [https://docs.kernel.org/dev-tools/kasan.html](https://docs.kernel.org/dev-tools/kasan.html)